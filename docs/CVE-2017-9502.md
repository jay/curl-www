URL file scheme drive letter buffer overflow
============================================

Project curl Security Advisory, June 14th 2017 -
[Permalink](https://curl.se/docs/CVE-2017-9502.html)

VULNERABILITY
-------------

When libcurl is given either

 1. a file: URL that does not use two slashes following the colon, or
 2. is told that file is the default scheme to use for URLs without scheme

... and the given path starts with a drive letter and libcurl is built for
Windows or DOS, then libcurl would copy the path with a wrong offset, so that
the end of the given path would write beyond the malloc buffer. Up to seven
bytes too much.

INFO
----

HTTP redirects to file: URLs are not affected.

For version 7.54.1, the function that cleans up the file: URLs is fixed to not
copy things out of the buffer!

The Common Vulnerabilities and Exposures (CVE) project has assigned the name
CVE-2017-9502 to this issue.

CWE-122: Heap-based Buffer Overflow

Severity: High

AFFECTED VERSIONS
-----------------

This bug is present on libcurl builds that accept drive letters in filenames,
which is limited to Windows and DOS builds, including Cygwin.

- Affected versions: libcurl 7.53.0 to and including 7.54.0
- Not affected versions: libcurl < 7.53.0 and >= 7.54.1
- Introduced-in: https://github.com/curl/curl/commit/1d4202ade602

libcurl is used by many applications, but not always advertised as such!

SOLUTION
------------

The function now takes better care to allocate memory enough to store what's
copied and to copy the strings to the correct output offsets.

- Fixed-in: https://github.com/curl/curl/commit/5d7952f52e410e1d4a8

RECOMMENDATIONS
---------------

We suggest you take one of the following actions immediately, in order of
preference:

 A - Upgrade curl and libcurl to version 7.54.1

 B - Apply the patch to your version and rebuild

 C - Do not use file URLs on Windows

TIMELINE
---------

It was reported to the curl project on June 4, 2017. We contacted MITRE on
June 7.

libcurl 7.54.1 was released on June 14 2017, coordinated with the publication
of this advisory.

CREDITS
-------

- Reported-by: Marcel Raad
- Patched-by: Daniel Stenberg

Thanks a lot!
